#!/bin/bash

# Install packages from pkglist.txt
if command -v pacman &> /dev/null; then
    echo "Installing packages with pacman..."
    sudo pacman -S --needed --noconfirm $(cat {{ .chezmoi.sourceDir }}/pkglist.txt | grep -v '^#' | tr '\n' ' ')
fi

source ~/.profile

# Setup nvm and install Node.js 20.11.1
if command -v nvm &> /dev/null; then
    echo "Setting up Node.js with nvm..."
    source /usr/share/nvm/nvm.sh
    nvm install 20.11.1
    nvm use 20.11.1
    nvm alias default 20.11.1
    echo "Node.js 20.11.1 installed and set as default"
fi

# Install RVM and Ruby 1.9.3
if ! command -v rvm &> /dev/null; then
    echo "Installing RVM..."
    curl -sSL https://get.rvm.io | bash -s stable --ruby=1.9.3
    source ~/.rvm/scripts/rvm
    rvm use 1.9.3 --default
    echo "RVM and Ruby 1.9.3 installed"
else
    echo "RVM already installed, ensuring Ruby 1.9.3 is available..."
    source ~/.rvm/scripts/rvm
    if ! rvm list | grep -q "1.9.3"; then
        rvm install 1.9.3
    fi
    rvm use 1.9.3 --default
fi
